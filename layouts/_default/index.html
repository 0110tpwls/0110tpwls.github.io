{{- define "main" }}

{{- if .Site.Params.homeInfoParams }}
<article class="first-entry home-info">
    {{- if .Site.Params.homeInfoParams.imageUrl }}
    <!-- Mobile: Image appears first (on top) -->
    {{- $imageUrl := .Site.Params.homeInfoParams.imageUrl }}
    {{- if not (hasPrefix $imageUrl "/") }}
        {{- $imageUrl = printf "/%s" $imageUrl }}
    {{- end }}
    <div class="entry-header-image mobile-first">
        <img src="{{ $imageUrl | absURL }}" 
             alt="{{ .Site.Params.homeInfoParams.imageTitle | default "profile image" }}"
             title="{{ .Site.Params.homeInfoParams.imageTitle | default "profile image" }}"
             width="{{ .Site.Params.homeInfoParams.imageWidth | default 160 }}"
             height="{{ .Site.Params.homeInfoParams.imageHeight | default 160 }}">
    </div>
    {{- end }}
    
    <header class="entry-header">
        <h1>{{ .Site.Params.homeInfoParams.Title | default .Site.Title }}</h1>
    </header>
    
    {{- if .Site.Params.homeInfoParams.imageUrl }}
    <!-- Desktop: Image appears on the right side -->
    {{- $imageUrl := .Site.Params.homeInfoParams.imageUrl }}
    {{- if not (hasPrefix $imageUrl "/") }}
        {{- $imageUrl = printf "/%s" $imageUrl }}
    {{- end }}
    <div class="entry-header-image desktop-only">
        <img src="{{ $imageUrl | absURL }}" 
             alt="{{ .Site.Params.homeInfoParams.imageTitle | default "profile image" }}"
             title="{{ .Site.Params.homeInfoParams.imageTitle | default "profile image" }}"
             width="{{ .Site.Params.homeInfoParams.imageWidth | default 160 }}"
             height="{{ .Site.Params.homeInfoParams.imageHeight | default 160 }}">
    </div>
    {{- end }}
    
    <div class="entry-content">
        {{ .Site.Params.homeInfoParams.Content | markdownify }}
    </div>
    
    {{- if .Site.Params.socialIcons }}
    <footer class="entry-footer">
        {{ partial "social_icons.html" (dict "Params" .Site.Params) }}
    </footer>
    {{- end }}
</article>
{{- end }}

{{- $pages := where site.RegularPages "Type" "in" site.Params.mainSections }}
{{- $paginator := .Paginate $pages }}
{{- $term := .Data.Term }}
{{- if (and (and (not $term) (eq $paginator.PageNumber 1)) (not (eq .Site.Params.homeInfoParams.enabled false))) }}
    {{- $limit := .Site.Params.postsOnHomePage | default 6 }}
    {{- range first $limit $pages }}
        {{- partial "postbox.html" . }}
    {{- end }}
{{- else }}
    {{- range $paginator.Pages }}
        {{- partial "postbox.html" . }}
    {{- end }}
{{- end }}
{{- if gt $paginator.TotalPages 1 }}
    <footer class="page-footer">
        <nav class="pagination">
            {{- if $paginator.HasPrev }}
            <a class="prev" href="{{ $paginator.Prev.URL }}">«&nbsp;{{ i18n "prev_page" }}</a>
            {{- end }}
            {{- if $paginator.HasNext }}
            <a class="next" href="{{ $paginator.Next.URL }}">{{ i18n "next_page" }}&nbsp;»</a>
            {{- end }}
        </nav>
    </footer>
{{- end }}

{{- end }}{{/* end main */}}
